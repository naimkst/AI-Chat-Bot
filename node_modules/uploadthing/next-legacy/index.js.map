{"version":3,"file":"index.js","names":["opts?: CreateBuilderOptions<TErrorShape>","opts: RouteHandlerOptions<TRouter>","req: NextApiRequest","res: NextApiResponse"],"sources":["../src/next-legacy.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\nimport * as Effect from \"effect/Effect\";\n\nimport type { Json } from \"@uploadthing/shared\";\n\nimport { makeAdapterHandler } from \"./_internal/handler\";\nimport { toWebRequest } from \"./_internal/to-web-request\";\nimport type { CreateBuilderOptions } from \"./_internal/upload-builder\";\nimport { createBuilder } from \"./_internal/upload-builder\";\nimport type { FileRouter, RouteHandlerOptions } from \"./types\";\n\nexport {\n  UTFiles,\n  /**\n   * This is an experimental feature.\n   * You need to be feature flagged on our backend to use this\n   */\n  UTRegion as experimental_UTRegion,\n} from \"./_internal/types\";\nexport type { FileRouter };\n\ntype AdapterArgs = {\n  req: NextApiRequest;\n  res: NextApiResponse;\n};\n\nexport const createUploadthing = <TErrorShape extends Json>(\n  opts?: CreateBuilderOptions<TErrorShape>,\n) => createBuilder<AdapterArgs, TErrorShape>(opts);\n\nexport const createRouteHandler = <TRouter extends FileRouter>(\n  opts: RouteHandlerOptions<TRouter>,\n) => {\n  const handler = makeAdapterHandler<\n    [NextApiRequest, NextApiResponse],\n    AdapterArgs\n  >(\n    (req, res) => Effect.succeed({ req, res }),\n    (req) => toWebRequest(req),\n    opts,\n    \"nextjs-pages\",\n  );\n\n  return async (req: NextApiRequest, res: NextApiResponse) => {\n    const response = await handler(req, res);\n    res.status(response.status);\n    for (const [name, value] of response.headers) {\n      res.setHeader(name, value);\n    }\n    // FIXME: Should be able to just forward it instead of consuming it first\n    return res.json(await response.json());\n  };\n};\n"],"mappings":";;;;;;;;AA0BA,MAAa,oBAAoB,CAC/BA,SACG,cAAwC,KAAK;AAElD,MAAa,qBAAqB,CAChCC,SACG;CACH,MAAM,UAAU,mBAId,CAAC,KAAK,QAAQ,OAAO,QAAQ;EAAE;EAAK;CAAK,EAAC,EAC1C,CAAC,QAAQ,aAAa,IAAI,EAC1B,MACA,eACD;AAED,QAAO,OAAOC,KAAqBC,QAAyB;EAC1D,MAAM,WAAW,MAAM,QAAQ,KAAK,IAAI;AACxC,MAAI,OAAO,SAAS,OAAO;AAC3B,OAAK,MAAM,CAAC,MAAM,MAAM,IAAI,SAAS,QACnC,KAAI,UAAU,MAAM,MAAM;AAG5B,SAAO,IAAI,KAAK,MAAM,SAAS,MAAM,CAAC;CACvC;AACF"}